[→ بخش ۵-۱: کتابخانه‌های قدرتمند: NumPy، Pandas و Scikit-learn](./01-powerful-libraries-numpy-pandas-sklearn.md) | [بخش ۵-۳: اولین مدل طبقه‌بندی شما: الگوریتم K-نزدیک‌ترین همسایه (KNN) ←](./03-first-classification-model-knn.md)

# فصل ۵: ساخت اولین مدل‌های پیش‌بینی: از داده تا تشخیص

## بخش ۵-۲: هنر آماده‌سازی: رام کردن داده‌های زیستی

یک اصل اساسی در علم داده وجود دارد: **"آشغال ورودی، آشغال خروجی" (Garbage In, Garbage Out)**. شما می‌توانید بهترین الگوریتم هوش مصنوعی دنیا را در اختیار داشته باشید، اما اگر داده‌هایی که به آن می‌دهید کثیف، ناقص یا نامرتب باشند، نتایج شما بی‌ارزش خواهند بود. در این بخش، به سراغ یکی از مهم‌ترین و در عین حال پرچالش‌ترین مراحل علم داده، یعنی آماده‌سازی داده، می‌رویم.

### 🎯 مسئله محوری: چگونه می‌توانیم داده‌های "وحشی" و نامرتب زیستی را برای تحلیل هوشمند، "رام" و آماده کنیم؟

داده‌های زیستی در دنیای واقعی، مانند نمونه‌های جمع‌آوری شده از طبیعت، به ندرت تمیز و یکدست هستند. در یک جدول اطلاعات بیماران، ممکن است سن یک فرد ثبت نشده باشد، جنسیت با فرمت‌های مختلف (M, Male, m) وارد شده باشد، و نتایج آزمایشگاهی به صورت متن و عدد با هم ترکیب شده باشند. یک مدل یادگیری ماشین، درست مانند یک ابزار آزمایشگاهی دقیق، به ورودی‌های استاندارد و تمیز نیاز دارد. چگونه می‌توانیم این داده‌های خام و پر از خطا را به یک مجموعه داده‌ی ساختاریافته، کامل و تماماً عددی تبدیل کنیم که برای آموزش یک مدل پیش‌بینی‌کننده آماده باشد؟ این فرآیند، که به آن "آماده‌سازی داده" می‌گویند، شاید جذاب‌ترین بخش کار نباشد، اما بدون شک مهم‌ترین آن است.

---

در دنیای واقعی، داده‌های زیستی تقریباً هرگز بی‌نقص نیستند. همیشه مقادیر گمشده، خطاهای ورود داده، یا فرمت‌های ناسازگار وجود دارند. تخمین زده می‌شود که دانشمندان داده تا ۸۰٪ از زمان خود را صرف تمیز کردن و آماده‌سازی داده‌ها می‌کنند، نه ساختن مدل.

### یک نمونه داده کثیف

بیایید با یک دیتافریم `pandas` کار را شروع کنیم که نمونه‌ای کوچک از داده‌های بیماران با مشکلات رایج است.

```python
import pandas as pd
import numpy as np

# ساخت دیتافریم با داده‌های کثیف
data = {
    'PatientID': ['P001', 'P002', 'P003', 'P004', 'P005'],
    'Age': [45, 62, np.nan, 38, 55], # np.nan یک مقدار گمشده است
    'Sex': ['F', 'M', 'F', 'M', 'Female'], # مقادیر ناسازگار
    'Gene_Expression': [12.5, 21.0, 9.7, 15.2, 22.1],
    'Diagnosis': ['Cancer', 'Healthy', 'Cancer', 'Healthy', 'Cancer']
}
df = pd.DataFrame(data)

print("دیتافریم اولیه:")
print(df)
```

### مراحل پاک‌سازی داده‌ها

ما قدم به قدم مشکلات این دیتافریم را با استفاده از `pandas` حل خواهیم کرد.

#### ۱. رسیدگی به مقادیر گمشده (Missing Values)

اولین مشکل، مقدار `NaN` (Not a Number) در ستون `Age` است. ما دو راه اصلی داریم: حذف سطر یا جایگزینی مقدار. از آنجایی که داده‌های ما کم هستند، حذف سطر ایده خوبی نیست. به جای آن، مقدار گمشده را با **میانگین سنی** بقیه بیماران پر می‌کنیم.

```python
# محاسبه میانگین ستون Age
mean_age = df['Age'].mean()

# پر کردن مقادیر NaN با میانگین
df['Age'].fillna(mean_age, inplace=True)

print("\nدیتافریم پس از پر کردن مقادیر گمشده:")
print(df)
```

**نکته:** `inplace=True` به `pandas` می‌گوید که تغییرات را مستقیماً روی دیتافریم اصلی اعمال کند.

#### ۲. استانداردسازی داده‌های دسته‌ای (Categorical Data)

مشکل بعدی، ستون `Sex` است که مقادیر `F`, `M`, و `Female` را دارد. ما باید این مقادیر را یکپارچه کنیم. ما تصمیم می‌گیریم که همه را به `F` و `M` تبدیل کنیم.

```python
# جایگزینی 'Female' با 'F'
df['Sex'].replace('Female', 'F', inplace=True)

print("\nدیتافریم پس از استانداردسازی ستون Sex:")
print(df)
```

#### ۳. تبدیل داده‌ها برای مدل (Feature Engineering)

مدل‌های یادگیری ماشین با اعداد کار می‌کنند، نه با متن. بنابراین، ما باید ستون‌های غیرعددی خود (`Sex` و `Diagnosis`) را به فرمت عددی تبدیل کنیم.

برای ستون `Diagnosis` که هدف ماست، می‌توانیم به سادگی از یک جایگزینی دستی استفاده کنیم: `Healthy` به `0` و `Cancer` به `1`.

```python
# تبدیل ستون هدف (Diagnosis)
df['Diagnosis'].replace({'Healthy': 0, 'Cancer': 1}, inplace=True)
```

برای ستون `Sex`، که یکی از ویژگی‌های ورودی (feature) ماست، استفاده از ۰ و ۱ می‌تواند مدل را به اشتباه بیندازد که M > F است. بهترین کار استفاده از روش **One-Hot Encoding** است. در این روش، ستون `Sex` به دو ستون جدید (`Sex_F` و `Sex_M`) تبدیل می‌شود که فقط مقادیر ۰ یا ۱ دارند. کتابخانه `pandas` این کار را با تابع `pd.get_dummies()` به راحتی انجام می‌دهد.

```python
# تبدیل ستون ویژگی (Sex) با One-Hot Encoding
df = pd.get_dummies(df, columns=['Sex'], drop_first=True) # drop_first=True برای جلوگیری از افزونگی

print("\nدیتافریم پس از تبدیل نهایی:")
print(df)
```

اکنون تمام ستون‌های ما عددی هستند!

### جدا کردن ویژگی‌ها (X) و هدف (y)

آخرین قدم در آماده‌سازی داده‌ها، جدا کردن دیتافریم به دو بخش است:

- **`X`**: ماتریس ویژگی‌ها (Features). اینها داده‌های ورودی هستند که مدل ما برای یادگیری از آنها استفاده می‌کند (تمام ستون‌ها به جز ستون هدف).
- **`y`**: بردار هدف (Target). این ستونی است که ما می‌خواهیم مدل یاد بگیرد آن را پیش‌بینی کند (`Diagnosis`).

```python
# ستون 'PatientID' برای مدل‌سازی لازم نیست، پس آن را حذف می‌کنیم
X = df.drop(columns=['PatientID', 'Diagnosis'])
y = df['Diagnosis']

print("\nماتریس ویژگی‌ها (X):")
print(X)

print("\nبردار هدف (y):")
print(y)
```

داده‌های ما اکنون کاملاً تمیز، آماده و در فرمت صحیح برای ورود به یک مدل یادگیری ماشین در Scikit-learn هستند.

---

### 🔬 تمرین تحلیلی: رسیدگی به داده‌های جدید

دیتافریم زیر را در نظر بگیرید. این دیتافریم حاوی داده‌های بیان ژن برای چند نمونه است، اما مشکلات خاص خود را دارد. کدهای لازم برای پاک‌سازی و آماده‌سازی این دیتافریم را بنویسید.

```python
import pandas as pd
import numpy as np

data = {
    'SampleID': ['S1', 'S2', 'S3', 'S4'],
    'Tissue_Type': ['Tumor', 'Normal', 'Tumor', 'Unknown'], # مقدار نامعتبر
    'Gene_A_Expr': [150.2, 89.9, 180.5, 165.1],
    'Gene_B_Expr': [75.6, 99.1, -1.0, 82.3], # مقدار منفی نامعتبر
    'Batch': [1, 2, 1, 2]
}
new_df = pd.DataFrame(data)
```

**مراحل مورد نیاز:**

1.  سطری که در آن `Tissue_Type` برابر با `'Unknown'` است را به طور کامل حذف کنید.
2.  در ستون `Gene_B_Expr`، هر مقدار منفی را با صفر جایگزین کنید (زیرا بیان ژن نمی‌تواند منفی باشد).
3.  ستون `Tissue_Type` را به فرمت عددی تبدیل کنید (`Normal`=0, `Tumor`=1).
4.  در نهایت، دیتافریم پاک‌سازی شده را چاپ کنید.

**پاسخ و راه حل:**

```python
# کپی کردن دیتافریم اولیه برای جلوگیری از تغییر ناخواسته
cleaned_df = new_df.copy()

# 1. حذف ردیف با مقدار 'Unknown'
# ابتدا ایندکس ردیف(های) مورد نظر را پیدا می‌کنیم
unknown_index = cleaned_df[cleaned_df['Tissue_Type'] == 'Unknown'].index
# سپس آن ردیف(ها) را با استفاده از drop حذف می‌کنیم
cleaned_df.drop(unknown_index, inplace=True)

# 2. جایگزینی مقادیر منفی با صفر
# ما از .loc برای انتخاب سطرها و ستون‌های خاص برای تغییر استفاده می‌کنیم
cleaned_df.loc[cleaned_df['Gene_B_Expr'] < 0, 'Gene_B_Expr'] = 0

# 3. تبدیل ستون 'Tissue_Type' به عدد
cleaned_df['Tissue_Type'].replace({'Normal': 0, 'Tumor': 1}, inplace=True)

# 4. چاپ نتیجه نهایی
print("\nدیتافریم نهایی پاک‌سازی شده:")
print(cleaned_df)
```

### 💡 نکات کلیدی این بخش

- **اصل GIGO:** کیفیت مدل هوش مصنوعی شما مستقیماً به کیفیت داده‌های ورودی بستگی دارد.
- **مقادیر گمشده:** مقادیر `NaN` را می‌توان با میانگین، میانه یا یک مقدار ثابت پر کرد و یا سطر مربوط به آنها را حذف نمود.
- **استانداردسازی:** داده‌های متنی (Categorical) باید یکپارچه شوند (مثلاً `Female` به `F`).
- **تبدیل به عدد:** تمام ویژگی‌های ورودی به مدل باید عددی باشند. از روش‌هایی مانند جایگزینی مستقیم یا **One-Hot Encoding** برای این کار استفاده می‌شود.
- **جداسازی X و y:** قبل از آموزش مدل، باید ویژگی‌های ورودی (`X`) از ستون هدف (`y`) جدا شوند.

آماده‌سازی داده یک مهارت حیاتی است. با داده‌های تمیز، ما آماده‌ایم تا در بخش بعدی اولین مدل پیش‌بینی‌کننده خود را بسازیم و آموزش دهیم.
